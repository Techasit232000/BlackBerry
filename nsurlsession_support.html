<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BlackBerry Dynamics: NSURLSession Support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen_13.1.0.48.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra_13.1.0.48.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
	<div id="titleheadings">
	<ul> 
		<li id="projectlogo">
	 		<a id="corplink" href="https://blackberry.com/"><img alt="Logo" src="BlackBerryLogo.png"/></a></li>
	 	<li id="projectname">BlackBerry Dynamics</li>
	  	<li id="projectbrief">Runtime library for iOS applications</li>
	  	<li id="projectnumber">13.1.0.48</li>
	 </ul>
	</div>
	 <div id="titlelinks">
	 		<a href="https://developers.blackberry.com">BlackBerry Developers</a>
	 </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('nsurlsession_support.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">NSURLSession Support </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>BlackBerry Dynamics applications can utilize the native URL session programming interface, NSURLSession, to communicate with servers that are behind the enterprise firewall. Communication across the enterprise firewall utilizes the BlackBerry Dynamics proxy infrastructure, which is secure.</p>
<p>Support for the native programming interface is provided by the BlackBerry Dynamics runtime, which has its own URL session implementation based on custom protocols. The BlackBerry Dynamics session implementation will be utilized by default in the application, after BlackBerry Dynamics authorization processing has completed.</p>
<p>The BlackBerry Dynamics URL session implementation doesn't support background tasks.</p>
<dl class="section see"><dt>See also</dt><dd><a href="https://developer.apple.com/reference/foundation/nsurlsession?language=objc" target="_blank">NSURLSession Class Reference</a> on the apple.com developer website. </dd>
<dd>
<a class="el" href="interface_g_di_o_s.html">GDiOS</a>, for BlackBerry Dynamics authorization. </dd>
<dd>
<a class="el" href="background_execution.html">Background Execution</a> page in the appendix. </dd>
<dd>
<a class="el" href="interface_g_d_u_r_l_loading_system.html">GDURLLoadingSystem</a> </dd>
<dd>
<a class="el" href="interface_g_d_net_utility.html">GDNetUtility</a></dd></dl>
<h2>Usage</h2>
<p>The BlackBerry Dynamics URL session can be utilized after authorization processing is complete. Use the native <code>NSURLSession</code> programming interface as usual, for example:</p><ul>
<li>Create a task in the shared session, by referring to the <code>NSURLSession</code> <code>sharedSession</code> property.</li>
<li>Start a new session, by creating a new <code>NSURLSession</code> instance, and then create a task in the new session.</li>
</ul>
<p>The task will be executed by the BlackBerry Dynamics URL session implementation, but see the limitations below.</p>
<p>The BlackBerry Dynamics secure store will be utilized, as follows:</p><ul>
<li>Browser cookies are persisted in the secure store. See HTTP Cookie Handling below.</li>
<li>The default store isn't used to cache retrieved files. Instead, a separate secure cache is used, see under Secure Cache, below.</li>
<li>Kerberos tickets are persisted on the device in the secure store.</li>
</ul>
<p>Use of the BlackBerry Dynamics URL session can be switched off and on by using:</p><ul>
<li><a class="el" href="interface_g_d_u_r_l_loading_system.html#a2752379c08bbab17313f9320a26b3181">GDURLLoadingSystem::disableSecureCommunication </a>.</li>
<li><a class="el" href="interface_g_d_u_r_l_loading_system.html#a42c230c470d5d61b8a0eb4d7578066be">GDURLLoadingSystem::enableSecureCommunication </a>.</li>
</ul>
<p>Finish any current sessions before switching off use of the BlackBerry Dynamics URL session. Any current sessions other than the shared session will be invalidated when use is switched off.</p>
<h3>Enterprise server connection notes</h3>
<p>BlackBerry Dynamics secure communication can be used to connect to servers that are behind the enterprise firewall. This applies to socket connections and HTTP requests. Note the following when using this capability.</p>
<p>The addresses of any application servers to which connection is being made must be configured in the enterprise management console. The address could be registered as the application's server, or as an additional server, for example.</p>
<p>Note. The application server configuration set in the management console can be obtained in the application code by using the <a class="el" href="interface_g_di_o_s.html#a3265c6148406a8850ba673b26e472ece">getApplicationConfig (GDiOS) </a> function.</p>
<p>The connection to the application server will be made through the BlackBerry Dynamics proxy infrastructure. The status of the application's connection to the proxy infrastructure can be checked and monitored by using the <a class="el" href="interface_g_d_reachability.html" title="BlackBerry Dynamics infrastructure connection status.">GDReachability</a> interface.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="developmentguides.html#GC">System administration tasks</a> </dd>
<dd>
<a class="el" href="interface_g_d_reachability.html">GDReachability </a> class reference.</dd></dl>
<h3>HTTPS Security</h3>
<p>BlackBerry Dynamics secure communications support HTTPS, using a Secure Socket Layer connection or Transport Layer Security (SSL/TLS) to send the HTTP request and receive the response. </p><h4>Secure Protocol Selection</h4>
<p>Establishing an SSL/TLS connection can involve negotiating and retrying, in order to select a secure protocol that is supported by both client and server. The BlackBerry Dynamics runtime handles client-side negotiation and retrying, if secure communication is in use.</p>
<p>The following protocol versions can be blocked by enterprise management console configuration. </p><div class="bulletlists"><ul>
<li>SSLv3</li>
<li>TLSv1.0</li>
<li>TLSv1.1</li>
<li>TLSv1.2</li>
</ul>
</div><p>The configuration of blocked protocol versions can be done in the enterprise management console user interface. The configuration applies at the deployment level and isn't specific to user, policy group, or application server. The block only affects communication with application servers that is routed via the BlackBerry Dynamics proxy infrastructure.</p>
<h4>Authentication Method Selection</h4>
<p>The application code can use the native NSURLSession programming interface to force the connection not to use particular authentication types. There isn't any need to set the <code>GDRejectAuthSupport</code> build option that is documented in the <a class="el" href="interface_g_d_u_r_l_loading_system.html">GDURLLoadingSystem</a> class reference.</p>
<h3>HTTP Cookie Handling</h3>
<p>By default, HTTP cookies received through BlackBerry Dynamics secure communication are handled automatically:</p><ul>
<li>Set-cookie: headers that are received as part of an HTTP response are processed and then added to subsequent matching requests.</li>
<li>Persistent cookies are written to cookie storage in the BlackBerry Dynamics secure store.</li>
</ul>
<p>The BlackBerry Dynamics cookie store persists between executions of the application, and if the mobile device is switched off. The contents of the store can be managed with the native <code>NSHTTPCookieStorage</code> programming interface, and so can non-persistent cookies received through BlackBerry Dynamics secure communication.</p>
<p>Automatic handling of HTTP cookies received through BlackBerry Dynamics secure communication can be switched off, as follows.</p><ul>
<li>For communication that goes via the <code>GDURLLoad</code><code>ingSystem</code>, such as <code>NSURLSession</code> and <code>NSURLConnection</code>, call the <code>setHTTPShouldHandleCookies:</code> method of the associated <code>NSMutableURLRequest</code> instance.</li>
</ul>
<dl class="section see"><dt>See also</dt><dd><a href="https://developer.apple.com/reference/foundation/nshttpcookiestorage" target="_blank">NSHttpCookieStorage class reference</a> on the apple.com developer website. </dd>
<dd>
<a href="https://developer.apple.com/reference/foundation/nsmutableurlrequest?language=objc" target="_blank">NSMutableURLRequest class reference</a> on the apple.com developer website. But see also the Configuration Support notes, below.</dd></dl>
<h3>Kerberos Authentication</h3>
<p>BlackBerry Dynamics secure communication supports Kerberos version 5 authentication. When using Kerberos authentication:</p><ul>
<li>Credentials are initially taken in the same way as other credentials, with the same specified persistence.</li>
<li>The credentials will be a username in the form <em>user</em><code>@</code><em>realm</em>, and a password.</li>
<li>The credentials are used to request Kerberos tickets, which are stored.</li>
<li>The stored Kerberos tickets are then used to authenticate the user on any site that supports Kerberos authentication. So long as the ticket continues to be accepted, there is no need for credentials to be supplied again, and no authentication challenge.</li>
<li>This continues until a site does not accept the stored ticket (e.g. the ticket has expired and cannot be renewed).</li>
<li>The Kerberos realm must be accessible. Usually, this means that the Kerberos realm must be listed as an Additional Server in the management console.</li>
</ul>
<h2>Secure Cache</h2>
<p>There is a single URL cache in the BlackBerry Dynamics secure store that is utilized by all BlackBerry Dynamics secure communication in the application. This cache, the secure URL cache, is the only cache that can be used by the BlackBerry Dynamics URL session.</p>
<p>The secure URL cache can be configured via the <code>NSURLCache</code> <code>sharedURLCache</code> object, when the BlackBerry Dynamics URL session is being utilized. The properties of the object can be set as follows.</p><ul>
<li>Setting <code>memoryCapacity</code> isn't supported. A value of zero is assumed.</li>
<li>Setting other properties, such as <code>diskCapacity</code>, is supported.</li>
<li>The additional functions in the <a class="el" href="category_n_s_u_r_l_cache_07_g_d_u_r_l_cache_08.html">NSURLCache(GDURLCache)</a> category can be used.</li>
</ul>
<p>The secure cache can be switched off by doing any of the following.</p><ul>
<li>Create a new <code>NSURLSession</code> instance that is based on an <code>NSURLSessionConfiguration</code> in which the <code>URLCache</code> property is <code>nil</code>. Tasks in the session won't utilize the cache.</li>
<li>Set the <code>NSURLCache</code> <code>sharedURLCache</code> object to <code>nil</code>.</li>
<li>Change <code>NSURLCache</code> <code>sharedURLCache</code> to a different object when the BlackBerry Dynamics URL session is being utilized.</li>
</ul>
<dl class="section see"><dt>See also</dt><dd><a href="https://developer.apple.com/reference/foundation/nsurlcache" target="_blank">NSURLCache Class Reference</a> on the apple.com developer website.</dd></dl>
<h3>Secure Cache Code Snippets</h3>
<p>The following snippet illustrates setting disk capacity in the secure cache. </p><div class="fragment"><div class="line">[NSURLCache sharedURLCache].diskCapacity = 20 * 1024 * 1024; <span class="comment">// 20 Megabytes</span></div>
</div><!-- fragment --><p>The following snippet illustrates switching off caching. </p><div class="fragment"><div class="line">NSURLSessionConfiguration *configuration = [NSURLSessionConfiguration defaultSessionConfiguration];</div>
<div class="line">configuration.URLCache = nil;</div>
</div><!-- fragment --><p>The following snippet shows some code that would result in caching being switched off. </p><div class="fragment"><div class="line">NSUInteger capacity = 10 * 1024 * 1024; <span class="comment">// 10 Megabytes</span></div>
<div class="line">NSURLCache *urlCache = [[NSURLCache alloc] initWithMemoryCapacity:capacity</div>
<div class="line">                                                     diskCapacity:capacity</div>
<div class="line">                                                         diskPath:nil];</div>
<div class="line">[NSURLCache setSharedURLCache:URLCache];</div>
</div><!-- fragment --><h2>Limitations</h2>
<p>The following limitations apply to the BlackBerry Dynamics URL session implementation, compared to the native.</p>
<ul>
<li>Upload and download tasks can't be configured to run in background. The following constructor functions always fail:<ul>
<li><code>NSURLSessionConfiguration</code> <code>backgroundSessionConfigurationWithIdentifier:</code></li>
<li><code>NSURLSessionConfiguration</code> <code>backgroundSessionConfiguration:</code></li>
</ul>
</li>
<li>When BlackBerry Dynamics authorization completes, the <code>NSURLSession</code> <code>sharedSession</code> property value is changed. The new value refers to a session that is executed by the BlackBerry Dynamics runtime in the application. Tasks subsequently created in the session referred to by <code>sharedSession</code> aren't handed off to the system shared session.</li>
<li>Custom protocol classes that are registered before BlackBerry Dynamics authorization processing has completed are subscribed to the system shared session and won't be protected by BlackBerry Dynamics secure communication. This would apply to <code>NSURLProtocol</code> implementations for which <code>registerClass:</code> is called, for example.</li>
<li>Task suspension isn't supported. Calling the <code>NSURLSessionTask</code> <code>suspend</code> function has no effect on a task in a BlackBerry Dynamics URL session. The task will continue, and delegate callback functions in the application code could be invoked.</li>
<li>Stream tasks aren't supported. A task created by a <code>streamTask</code> constructor won't connect via the BlackBerry Dynamics proxy infrastructure.</li>
<li>Most metrics aren't provided. The <code>NSURLSessionTaskMetrics</code> object associated with a BlackBerry Dynamics URL session may only include the URL, the request start and end times, and the response start time.</li>
<li><code>NSURLSessionTask</code> <code>earliestBeginDate</code> isn't supported. The <code>NSURLSessionTaskDelegate</code> <code>willBeginDelayedRequest</code> method is never invoked.</li>
<li>BlackBerry Dynamics doesn't support canceling upload task with latest resuming process of uploading data. Upload task created by <code>resumeData</code> constructors (<code>uploadTaskWithResumeData:</code>, <code>uploadTaskWithResumeData:completionHandler:</code> ) won't connect via the BlackBerry Dynamics proxy infrastructure.</li>
<li>Not all configuration options are supported. See the notes under Configuration Support, below.</li>
</ul>
<p>The limitations apply whenever the BlackBerry Dynamics URL session is used, whether or not the connection goes via the proxy infrastructure.</p>
<h2>Configuration Support</h2>
<p>The native <code>NSURLSessionConfiguration</code> class offers a number of configuration properties, but not all are supported by the BlackBerry Dynamics URL session. See the following notes. </p><h3>Supported</h3>
<ul>
<li><code>HTTPAdditionalHeaders</code> is supported.</li>
<li><code>timeoutIntervalForRequest</code> is supported.</li>
<li><code>timeoutIntervalForResource</code> is supported.</li>
<li><code>TLSMaximumSupportedProtocol</code> is supported.</li>
<li><code>TLSMinimumSupportedProtocol</code> is supported.</li>
<li><code>requestCachePolicy</code> is supported.</li>
<li><code>protocolClasses</code> is supported.</li>
<li><code>connectionProxyDictionary</code> is supported.</li>
<li><code>HTTPCookieStorage</code> is supported.</li>
</ul>
<h3>Unsupported</h3>
<ul>
<li><code>networkServiceType</code>: <code>NSURLNetworkServiceTypeDefault</code> is assumed.</li>
<li><code>allowsCellularAccess</code>: <code>YES</code> is assumed.</li>
<li><code>sharedContainerIdentifier</code> is ignored.</li>
<li><code>HTTPCookieAcceptPolicy</code> is ignored.</li>
<li><code>HTTPShouldSetCookies</code> is ignored.</li>
<li><code>URLCredentialStorage</code> is ignored.</li>
<li><code>URLCache</code> can be set to <code>nil</code> but isn't otherwise supported, also see under Secure Cache, above.</li>
<li><code>sessionSendsLaunchEvents</code> is ignored. Background tasks aren't supported.</li>
<li><code>discretionary</code> is ignored. Background tasks aren't supported.</li>
<li><code>HTTPMaximumConnectionsPerHost</code> is ignored.</li>
<li><code>HTTPShouldUsePipelining</code> isn't supported.</li>
<li><code>multipathServiceType</code>: <code>NSURLSessionMultipathServiceTypeNone</code> is assumed.</li>
<li><code>waitsForConnectivity</code>: <code>NO</code> is assumed. The <code>NSURLSessionTaskDelegate</code> <code>taskIsWaitingForConnectivity</code> method is never invoked.</li>
<li><code>requiresDNSSECValidation</code> is ignored.</li>
<li><code>allowsExpensiveNetworkAccess</code> is ignored.</li>
<li><code>allowsConstrainedNetworkAccess</code> is ignored.</li>
<li><code>proxyConfigurations</code> is ignored.</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="developmentguides.html">Development Guides</a></li>
    <li class="footer">
Generated Wed Mar 12 2025 12:06:26
with v1.8.17 <a href="http://www.doxygen.org/index.html" target="_blank">doxygen</a >.
Version 13.1.0.48.
© 2025 BlackBerry Limited. All rights reserved.
    </li>
  </ul>
</div>
</body>
</html>
